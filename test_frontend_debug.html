<!DOCTYPE html>
<html>
<head>
    <title>Poker Frontend Debug Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { margin: 5px; padding: 10px; }
        #log { border: 1px solid #ccc; padding: 10px; min-height: 400px; background: #f5f5f5; font-family: monospace; font-size: 12px; }
        .log-entry { margin: 2px 0; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Poker Frontend Debug Test</h1>
    <div>
        <button onclick="connect()">Connect</button>
        <button onclick="setName()">Set Name</button>
        <button onclick="joinTable()">Join Table</button>
        <button onclick="startHand()">Start Hand</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    <h2>WebSocket Log:</h2>
    <div id="log"></div>

    <script>
        let ws = null;
        let token = localStorage.getItem('poker_token');
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function connect() {
            const url = token ? `ws://localhost:8080/ws?token=${token}` : 'ws://localhost:8080/ws';
            log(`Connecting to ${url}...`);
            
            ws = new WebSocket(url);
            
            ws.onopen = () => {
                log('WebSocket connected!', 'success');
            };
            
            ws.onmessage = (event) => {
                log(`← Received: ${event.data}`, 'info');
                try {
                    const msg = JSON.parse(event.data);
                    
                    // Handle session tokens
                    if (msg.type === 'session_created' || msg.type === 'session_restored') {
                        if (msg.payload) {
                            const payload = JSON.parse(msg.payload);
                            if (payload.token) {
                                token = payload.token;
                                localStorage.setItem('poker_token', token);
                                log(`Token saved: ${token}`, 'success');
                            }
                        }
                    }
                    
                    // Log specific message types
                    if (msg.type === 'hand_started') {
                        log(`hand_started payload (raw): ${JSON.stringify(msg.payload)}`, 'info');
                        if (msg.payload) {
                            const payload = JSON.parse(msg.payload);
                            log(`hand_started payload (parsed): ${JSON.stringify(payload)}`, 'success');
                            log(`  dealerSeat: ${payload.dealerSeat}`, 'success');
                            log(`  smallBlindSeat: ${payload.smallBlindSeat}`, 'success');
                            log(`  bigBlindSeat: ${payload.bigBlindSeat}`, 'success');
                        }
                    }
                } catch (e) {
                    log(`Parse error: ${e.message}`, 'error');
                }
            };
            
            ws.onerror = (error) => {
                log(`WebSocket error: ${error}`, 'error');
            };
            
            ws.onclose = () => {
                log('WebSocket closed', 'error');
            };
        }

        function send(message) {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log('WebSocket not connected!', 'error');
                return;
            }
            const msgStr = JSON.stringify(message);
            log(`→ Sending: ${msgStr}`);
            ws.send(msgStr);
        }

        function setName() {
            send({
                type: 'set_name',
                payload: { name: 'TestPlayer' + Math.floor(Math.random() * 1000) }
            });
        }

        function joinTable() {
            send({
                type: 'join_table',
                payload: { tableId: 'table-1' }
            });
        }

        function startHand() {
            send({
                type: 'start_hand',
                payload: {}
            });
        }

        // Auto-connect on load
        window.onload = () => {
            log('Page loaded. Click Connect to start.');
        };
    </script>
</body>
</html>
